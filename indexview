<link href="~/css/bootbox-modal-custom.css" rel="stylesheet" />
<script src="~/js/jquery.min.js"></script>

<!-- DataTables CSS & JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<div class="block justify-between page-header md:flex">
    <ol class="flex items-center whitespace-nowrap min-w-0">
        <li class="text-[0.813rem] ps-[0.5rem]">
            <a class="flex items-center text-primary hover:text-primary dark:text-primary truncate" href="javascript:void(0);">
                @ViewData["Title"]
                <i class="ti ti-chevrons-right flex-shrink-0 text-[#8c9097] dark:text-white/50 px-[0.5rem] overflow-visible rtl:rotate-180"></i>
            </a>
        </li>
        <li class="text-[0.813rem] text-defaulttextcolor font-semibold hover:text-primary dark:text-[#8c9097] dark:text-white/50"> HoliDay List </li>
    </ol>
    <div>
        <button type="button" class="hs-dropdown-toggle ti-btn ti-btn-primary-full !px-2 !text-[0.75rem]" data-hs-overlay="#create_Holiday" onclick="AddHoliday()">
            <i class="ri-add-line font-semibold align-middle"></i>
            Add New Holiday
        </button>
    </div>
</div>

<div class="grid grid-cols-12 gap-6">
    <div class="xl:col-span-12 col-span-12">
        <div class="box custom-box custom-box-position">
            <div class="box-header justify-between">
                <div class="box-title">Holiday List</div>
            </div>
            <div class="box-body">
                <div class="table-responsive">
                    <table class="table whitespace-nowrap ti-striped-table table-hover min-w-full ti-custom-table-hover" id="tblHoliDayDetail">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Location</th>
                                <th>Start Date</th>
                                <th>Duration(Days)</th>
                                <th>WorkingOnHoliday</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="create_Holiday" class="hs-overlay ti-modal hidden" data-backdrop="">
    <div id="div_holiday">
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#tblHoliDayDetail').DataTable({
            "processing": true,
            "serverSide": false, 
            "ajax": {
                "url": "/HoliDayList/GetHolidays",
                "type": "GET",
                "datatype": "json"
            },
            "columns": [
                { "data": "name" },
                { "data": "location" },
                { "data": "startDate", "render": function (data) { return new Date(data).toLocaleDateString(); } },
                { "data": "duration" },
                { "data": "workingOnHoliday", "render": function (data) { return data ? "Yes" : "No"; } },


        {
            sWidth: "15%",
            data: "name",
            sortable: false,
            className: "dt-center",
            render: function (data, type, row, meta) {
                // Correctly pass the 'name' as a string to EditHoliday function
                var actionButtons = '<a onclick="EditHoliday(\'' + row.name + '\')" href="#" data-hs-overlay="#create_Holiday" title="Edit" class="hs-tooltip-toggle ti-btn ti-btn-primary ti-btn-sm"><i class="ri-edit-line"></i></a> &nbsp;&nbsp;';

                actionButtons += '<a id="lnkDelete" onclick="Deleted(\'' + row.name + '\')" href="#" data-hs-overlay="#create-deleted" class="hs-tooltip-toggle ti-btn ti-btn-danger ms-1 ti-btn-sm task-delete-btn" href="#" data-toggle="tooltip" title="Delete"><i class="ri-delete-bin-5-line"></i></a> &nbsp;&nbsp;';

                return actionButtons;
            }
        }
    

            ],
            "order": [[2, "asc"]], // Sorting by Start Date
            "language": {
                "emptyTable": "No holidays available."
            }
        });
    });

      // Function to open modal and fetch data for editing User details
    function AddHoliday() {
        $.ajax({
            url: '@Url.Action("AddHoliday", "HolidayList")',
            type: "GET",
            
            success: function (data) {
                $('#div_holiday').html(data); // Populate modal with User details form
            },
            error: function (data) {
                // Handle error if data fetching fails
            }
        });
    }

        function EditHoliday(name) {
            $.ajax({
                url: '@Url.Action("EditHoliday", "HolidayList")',
                type: "GET",
                data:{Name:name},
                success: function (data) {
                    $('#div_holiday').html(data);
                },
                error: function (data) {
                }
            });
        }

         function Deleted(name) {
            bootbox.confirm({
                title: "Confirm Deletion",
                className: "bold",
                message: "<strong>Are you absolutely sure you want to delete this item? This action cannot be undone</strong>",
                buttons: {
                    confirm: {
                        label: 'Yes, Delete',
                        className: 'ti-btn ti-btn-primary-full'
                    },
                    cancel: {
                        label: 'No',
                        className: 'hs-dropdown-toggle ti-btn ti-btn-light'
                    }
                },
                callback: function (result) {
                    if (result) {
                        $.ajax({
                            url: '@Url.Action("DeleteHoliday", "HolidayList")',
                            type: "POST",
                            data: { Name: name },
                            success: function (response) {
                                SetMessage(response); // Show success/error message
                            },
                            error: function (error) {
                                toastr.error('Error deleting record: ' + error.responseText); // Show error message
                            }
                        });
                    }

                }
            });
         }


    
</script>
